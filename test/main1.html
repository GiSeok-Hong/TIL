<!DOCTYPE html>
<html>
  <header>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.4/redux.js"></script>
  </header>
  <body>
    <div id="subject"></div>
    <div id="toc"></div>
    <div id="control"></div>
    <div id="content"></div>

    <script>
      function subject(){
        document.querySelector('#subject').innerHTML = `
        <header>
          <h1>WEB</h1>
          Hello, WEB!
        </header>
        `;
      }

      function TOC(){
        let state = store.getState();
        let i = 0;
        let liTags = '';
        while(i<state.contents.length){
          liTags = liTags + `
            <li>
              <a onclick=
                "
                event.preventDefault();
                let action = {type:'SELECT', id:${state.contents[i].id}}
                store.dispatch(action);
                " 
              href="${state.contents[i].id}">${state.contents[i].title}
            </li>
          `;
          i = i + 1;
        }
        document.querySelector('#toc').innerHTML = `
        <nav>
          <ol>${liTags}</ol>
        </nav>
        `;
      }

      function control() {
        document.querySelector('#control').innerHTML = `
        <ul>
          <li><a href="/create">create</a></li>
          <li><input type="button" value="delete"></li>
        </ul>
        `;
      }

      function article(){
        let state = store.getState();
        let i = 0;
        let aTitle, aDesc;
        while(i < state.contents.length){
          if(state.contents[i].id === state.selected_id){
            aTitle = state.contents[i].title;
            aDesc = state.contents[i].desc;
            break;
          }
          i = i + 1;
        }
        document.querySelector('#content').innerHTML = `
        <article>
          <h2>${aTitle}</h2>
          ${aDesc}
        </article>
        `;
      }

      function reducer(state, action){
        console.log(state,action);  // 값이 바뀌는지 보기 위해 넣은 코드
        if(state === undefined){ // 초기값 설정
          return {
            selected_id: null,
            contents:[
              {id:1, title:'HTML', desc:'HTML is...'},
              {id:2, title:'CSS', desc:'CSS is...'}
            ]
          }
        } // end if
        let newState;
        if(action.type === 'SELECT'){
          newState = Object.assign({}, state, {selected_id:action.id});
        }
        console.log(action, state, newState);
        return newState;
      }

      const store = Redux.createStore(reducer);
      store.subscribe(article);
      subject();
      TOC();
      control();
      article();
    </script>



  </body>

</html>
# 2019.06.21 (금)

***

## 팔로우, 팔로잉을 표현해보기

>**팔로우** (Follow)
>특정 대상을 팔로우하는 경우 그 대상의 소식을 만날 수 있습니다.
>
>**팔로잉** (Following)
>나 또는 특정 대상이 팔로우하는 사람을 뜻합니다.
>
>**팔로워** (Follower)
>나 또는 특정 대상을 팔로우하는 사람을 뜻합니다.

### 1. [accounts] - [models.py] 에  코드 추가

>``` python
>from django.db import models
>from django.conf import settings
>from django.contrib.auth.models import AbstractUser
>
>class User(AbstractUser):
>    followers = models.ManyToManyField(settings.AUTH_USER_MODEL, related_name='followings')
>```

### 2. [myform] - [setting.py] 에 코드 추가

>``` python
># 가장 아래에 아래 코드 추가
># AbstractUser 를 import 하기 위해서 지정해야 한다.
>AUTH_USER_MODEL = 'accounts.User'
>```
>
>

### 3. [accounts] - [admin.py] 에 코드 추가

>```python
>from django.contrib import admin
>### 아래 3줄 추가
>from django.contrib.auth.admin import UserAdmin
>from .models import User
>
>admin.site.register(User, UserAdmin)
>```
>
>

### 4.   [accounts] - [forms.py] 에 코드 추가

>``` python
>from django.contrib.auth.forms import UserChangeForm, UserCreationForm
>from django.contrib.auth import get_user_model
>
>class UserCustomChangeForm(UserChangeForm):
>    class Meta:
>        model = get_user_model()
>        fields = ('email', 'first_name', 'last_name')
>
>class UserCustomCreationForm(UserCreationForm):
>    class Meta(UserCreationForm.Meta):
>        model = get_user_model()
>        fields = UserCreationForm.Meta.fields
>```
>
>

### 5.  [accounts] - [views.py] 에 코드 추가

>``` python
>from .forms import UserCustomChangeForm, UserCustomCreationForm
>
>
>### UserCreationForm 을 UserCustomCreationForm으로 변경
>def signup(request):
>    if request.user.is_authenticated:             # 만약 로그인이 된 상태이면 바로 index 페이지로 보내버림
>        return redirect('boards:index')
>    if request.method == 'POST':
>        form = UserCustomCreationForm(request.POST)
>        if form.is_valid():
>            user = form.save()
>            auth_login(request, user)
>            return redirect('boards:index')
>    else:
>        form = UserCustomCreationForm()
>    context = {'form': form}
>    return render(request, 'accounts/auth_form.html', context)
>```
>
>

### 6. [boards] - [views.py]에  함수 추가

>``` python
># 팔로우 : 특정 대상을 팔로우하는 경우 그 대상의 소식을 만날 수 있습니다.
># 팔로워 : 나 또는 특정 대상을 팔로우하는 사람을 뜻합니다.
># 팔로잉 : 나 또는 특정 대상이 팔로우하는 사람을 뜻합니다.
>@login_required()
>def follow(request, board_pk, user_pk):
>    person = get_object_or_404(get_user_model(), pk=user_pk)
>    if request.user in person.followers.all():
>        person.followers.remove(request.user)
>    else:
>        person.followers.add(request.user)
>    return redirect('boards:detail', board_pk)
>```
>
>

### 7. [boards] - [urls.py] 에 코드 추가

>``` python
>from django.urls import path
>from . import views
>
>app_name = 'boards'
>
>urlpatterns = [
>    path('', views.index, name='index'),
>	~~~~ 
>    # 아래 경로를 추가
>    path('<int:board_pk/follow/<int:user_pk>/', views.follow, name='follow'),
>]
>```
>
>

### 8. [boards] - [views.py] 의 [detail] 함수에  코드 추가

>``` python
>def detail(request, board_pk):
>    board = get_object_or_404(Board, pk=board_pk)
>    person = get_object_or_404(get_user_model(), pk=board.user.pk)  # 추가 코드
>    comments = board.comment_set.all()
>    comment_form = CommentForm()
>    context = {
>        'board': board,
>        'comments': comments,
>        'comment_form': comment_form,
>        'person': person   # 추가 코드
>    }
>    return render(request, 'boards/detail.html', context)
>```
>
>

### 9. [boards] - [_profile.html] 생성 및 코드 작성

>``` html
><div class="jumbotron text-center text-white bg-dark">
>    <p class="lead mb-1">작성자 정보</p>
>    <h2 class="display">{{ board.user }}</h2>
>    <hr class="border-white">
>    <p class="lead">
>        팔로잉 : {{ person.followings.all | length }}
>        팔로워 : {{ person.followers.all | length }}
>    </p>
>    {% if user != person %}
>        {% if user in person.followers.all %}
>    <!-- '웹 접근성' :  a 태그의 'role'속성은 시각장애인들을 위해 스크린리더가 읽어주는 속성이다. img의 alt 속성과 비슷? -->
>            <a class='btn btn-primary' href="{% url 'boards:follow' board.pk person.pk %}" role="button">Unfollow</a>
>        {% else %}
>            <a class='btn btn-primary' href="{% url 'boards:follow' board.pk person.pk %}" role="button">Follow</a>
>        {% endif %}
>    {% endif %}
></div>
>```
>
>

### 10. [detail.html] 에 코드 추가

>``` html
>{% include 'boards/_profile.html' %}
>```
>
>

### 11. [myform] - [settings.py] 에 코드 추가

>* 필요 라이브러리 설치
>
>``` python shell
>$ pip install django-allauth
>```
>
>* 등록하기
>
>``` python
>AUTHENTICATION_BACKENDS = (						# 추가 코드
>    'django.contrib.auth.backends.ModelBackend',
>)
>
>INSTALLED_APPS = [
>    'accounts',
>    'boards',
>    'django.contrib.admin',
>    'django.contrib.auth',
>    'django.contrib.contenttypes',
>    'django.contrib.sessions',
>    'django.contrib.messages',
>    'django.contrib.staticfiles',
>
>    'django.contrib.sites',        			  # 추가 코드
>    'allauth',				      			 # 추가 코드
>    'allauth.account',		       			  # 추가 코드
>    'allauth.socialaccount',        		   # 추가 코드
>    'allauth.socialaccount.providers.kakao',    # 추가 코드
>
>    'bootstrap4',
>]
>```
>
>

### 12. [myform] - [urls.py] 에 추가

>``` python
>from django.contrib import admin
>from django.urls import path, include
>
>urlpatterns = [
>    path('accounts/', include('accounts.urls')),
>    
>    ## 아래 코드를 추가함
>    path('accounts/', include('allauth.urls')),  # 반드시 path('accounts/', include('accounts.urls')), 아래에 와야한다.
>    
>    
>    path('boards/', include('boards.urls')),
>    path('admin/', admin.site.urls),
>]
>```
>
>* migrate 하기


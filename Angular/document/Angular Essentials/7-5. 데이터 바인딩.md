# 5. 데이터 바인딩

### 1. 데이터 바인딩이란?

구조화된 웹 애플리케이션을 구축하기 위해서는 뷰와 모델의 분리가 필수이다. 하지만 분리된 뷰와 모델은 유기적으로 동작하여야 한다. 데이터 바인딩은 이러한 모순을 해결해준다.

**데이터 바인딩은 뷰와 모델을 하나로 연결하는 것을 의미한다**. Angular의 데이터 바인딩은 템플릿(View)과 컴포넌트 클래스의 데이터(Model)를 하나로 묶어 유기적으로 동작하게 하는 것을 말한다. 이는 템플릿의 정적 HTML에 컴포넌트의 동적 데이터를 하나로 묶어 브라우저에 표시할 완성된 뷰를 만들기 위함이다.

Angular는 DOM에 직접 접근하지 않고 템플릿과 컴포넌트 클래스의 상호 관계를 선언하는 방식(선언형 프로그래밍)으로 뷰와 모델을 관리한다. 이때 사용되는 것이 **데이터 바인딩**이며 이를 통해 템플릿과 컴포넌트 클래스는 연결된다. 데이터 바인딩은 **템플릿 문법**으로 기술된다.

HTML과 템플릿 문법으로 기술된 템플릿은 JIT 또는 AOT 컴파일러에 의해 브라우저가 이해할 수 있는 자바스크립트로 컴파일된다.

### 2. 변화 감지(Change detection)

변화 감지란 뷰와 모델의 동기화를 유지하기 위해 상태의 변화를 감지하고 이를 반영하는 것을 말한다. 즉, 상태의 변화를 감지하여 뷰에 반영하는 것으로 데이터 바인딩은 변화 감지 매커니즘의 토대 위에서 수행된다.

Angular는 양방향 바인딩과 단방향 바인딩을 모두 지원하며 zone.js 라이브러리를 사용하여 네이티브 DOM 이벤트를 사용하여도 변화 감지가 수행되도록 개선되었다.

변화 감지의 작동 원리에 대해 간단히 살펴본다

뷰의 상태 변화는 DOM 이벤트를 캐치하는 것으로 감지할 수 있다. 하지만 모델은 HTML 요소가 아니므로 이벤트가 발생하지 않는다. 따라서 모델의 변화 감지를 위해서는 별도의 조치가 필요하다. 모델이 변경된다는 것은 컴포넌트 클래스의 프로퍼티값이 변경되는 것을 의미한다.

[예시]

```tsx
import { Component } from '@angular/core';

@Component({
	selector: 'app-hello',
	template: `
		<h2>안녕하세요 {{ name }}</h2>
		<input type="text" placeholder="이름을 입력하세요" #inputYourName />
		<button (click)="setName(inputYourName.value)">등록</button>
	`,
  styleUrls: ['./hello.component.css'],
})
export class HelloComponent {
	name!: string;
	
	setName(name: string) {
		this.name = name;
	}
}
```

위 예제에서 클릭 이벤트에 의해 컴포넌트 클래스의 name 프로퍼티값이 변화했다. 이와 같이 컴포넌트 클래스의 프로퍼티값이 변경되는 상황, 즉 어떤 경우 모델이 변화하는지에 Angular는 주목한다.

- DOM 이벤트(click, key press, mouse move 등)
- Timer 함수(setTimeout, setInterval)의 tick 이벤트
- Ajax 통신 / Promise

위와 같은 비동기 처리가 수행될 때 컴포넌트 클래스의 데이터가 변경될 수 있다. 변화 감지는 모델이 변화할 수 있는 이러한 상황들을 감시한다.

이를 위해 zone.js는 addEventListener, Timer 함수, XMLHttpRequest, Promise 등을 몽키패치한다.

zone.js는 일부 함수를 프락시(Proxy)로 재정의하여 대체한다. 즉, 이벤트 또는 Promise가 프락시로 랩핑되는데 이러한 개념을 몽키패치라고 한다.

모델을 변화시킬 수 있는 비동기 처리가 호출되면 패치를 통해 호출을 후킹(hooking)한다. 비동기 처리 호출을 후킹할 수 있다는 것은 변화를 감지할 수 있다는 의미이다. 이 후킹 로직 내에서 변화 감지를 수행하고 변화가 감지될 때마다 Digest loop를 실행하여 모델의 변화를 뷰에 반영한다.

### 3. 데이터 바인딩

Angular는 아래와 같이 7가지 데이터 바인딩을 제공한다

| 데이터 바인딩        | 데이터의 흐름            | 문법                                 |
| -------------------- | ------------------------ | ------------------------------------ |
| 인터폴레이션         | 컴포넌트 클래스 → 템플릿 | {{ expression }}                     |
| 프로퍼티 바인딩      | 컴포넌트 클래스 → 템플릿 | [ property ] = “expression”          |
| 어트리뷰트 바인딩    | 컴포넌트 클래스 → 템플릿 | [attr.attribute-name] = “expression” |
| 클래스 바인딩        | 컴포넌트 클래스 → 템플릿 | [class.class-name] = “expression”    |
| 스타일 바인딩        | 컴포넌트 클래스 → 템플릿 | [style.style-name] = “expression”    |
| 이벤트 바인딩        | 컴포넌트 클래스 ← 템플릿 | (event)=”statement”                  |
| 양방향 데이터 바인딩 | 컴포넌트 클래스 ↔ 템플릿 | [ (ngModel) ] = “property”           |